# Home Assistant Automations for Foxess HA Amber Automation

## Master Automation Strategy
- id: master_automation_strategy
  alias: "Master Automation Strategy"
  description: "Master strategy for managing automation operations"
  trigger:
    - platform: time
      at: "00:00:00"
  action:
    - service: number.set_value
      target:
        entity_id: number.force_discharge_power
      data:
        value: 100

## Immediate Spike Discharge
- id: immediate_spike_discharge
  alias: "Immediate Spike Discharge"
  description: "Discharge immediately upon price spike"
  trigger:
    - platform: state
      entity_id: binary_sensor.home_assistant_price_spike
      to: "on"
  action:
    - service: number.set_value
      target:
        entity_id: number.force_discharge_power
      data:
        value: 100

## Secondary Rule Discharge
- id: secondary_rule_discharge
  alias: "Secondary Rule Discharge"
  description: "Discharges if secondary conditions are met"
  trigger:
    - platform: state
      entity_id: sensor.home_automation_battery_soc_1
      below: 20
  action:
    - service: number.set_value
      target:
        entity_id: number.force_discharge_power
      data:
        value: 50

## Secondary Rule Stop Discharge
- id: secondary_rule_stop_discharge
  alias: "Secondary Rule Stop Discharge"
  description: "Stops discharge when conditions are safe"
  trigger:
    - platform: state
      entity_id: sensor.home_automation_battery_soc_1
      above: 30
  action:
    - service: number.set_value
      target:
        entity_id: number.force_discharge_power
      data:
        value: 0

## Grid Backup Charge 1 PM
- id: grid_backup_charge_1pm
  alias: "Grid Backup Charge 1 PM"
  description: "Start charging from grid at 1 PM"
  trigger:
    - platform: time
      at: "13:00:00"
  action:
    - service: number.set_value
      target:
        entity_id: number.min_soc_on_grid
      data:
        value: 20

## Grid Backup Charge Stop 2 PM
- id: grid_backup_charge_stop_2pm
  alias: "Grid Backup Charge Stop 2 PM"
  description: "Stop charging from grid at 2 PM"
  trigger:
    - platform: time
      at: "14:00:00"
  action:
    - service: number.set_value
      target:
        entity_id: number.min_soc_on_grid
      data:
        value: 100

## Critical Protection Low SOC
- id: critical_protection_low_soc
  alias: "Critical Protection Low SOC"
  description: "Engages critical protection measures when SOC is low"
  trigger:
    - platform: state
      entity_id: sensor.home_automation_battery_soc_1
      below: 10
  action:
    - service: number.set_value
      target:
        entity_id: number.force_discharge_power
      data:
        value: 0

## Critical Protection Resume
- id: critical_protection_resume
  alias: "Critical Protection Resume"
  description: "Resumes regular operation when SOC is safe"
  trigger:
    - platform: state
      entity_id: sensor.home_automation_battery_soc_1
      above: 20
  action:
    - service: number.set_value
      target:
        entity_id: number.force_discharge_power
      data:
        value: 50

## Solar Priority Disable Discharge
- id: solar_priority_disable_discharge
  alias: "Solar Priority Disable Discharge"
  description: "Disables discharge when solar power is available"
  trigger:
    - platform: state
      entity_id: sensor.home_automation_solar_power
      above: 100
  action:
    - service: number.set_value
      target:
        entity_id: number.force_discharge_power
      data:
        value: 0

## Solar Priority Resume Discharge
- id: solar_priority_resume_discharge
  alias: "Solar Priority Resume Discharge"
  description: "Resumes discharge when solar priority is no longer met"
  trigger:
    - platform: state
      entity_id: sensor.home_automation_solar_power
      below: 50
  action:
    - service: number.set_value
      target:
        entity_id: number.force_discharge_power
      data:
        value: 50
